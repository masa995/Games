"use strict";var dataRules=[{textRules:"<p>Крестки-нолики</p>\n                <p>Игроки по очереди ставят на свободные клетки поля символы (один всегда крестики, другой всегда нолики). Первый, выстроивший в ряд 3 символа по вертикали, горизонтали или диагонали, выигрывает. Первый ход делает игрок, ставящий крестики.</p>"},{textRules:"<p>Змейка</p>\n                <p>Цель игры заключается в том, чтобы змейка съела как можно больше ягод. После каждой съеденной ягоды количество очков и размер змейки увеличивается.</p>\n                <p>Если змейка врежется в саму себя, то игра закончиться. На сложном уровне добавляются препятствия (серые кубы), с которыми змейка, также не должна сталкиваться.</p>\n                <p>Управление осуществляется стрелочками на клавиатуре.</p>"}],popup=document.querySelector(".js-popup"),popupBody=document.querySelector(".js-popup__body"),popupClose=document.querySelector(".js-popup__close-btn"),popupText=document.querySelector(".js-popup__text"),popupOpenBtns=document.querySelectorAll(".js-btn-ruls");function mapRuls(e){return{ticTacToe:0,snake:1}[e]}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}null!==popup&&(popupClose.addEventListener("click",(function(e){popup.classList.remove("active")})),popupBody.addEventListener("click",(function(e){e.target.closest(".js-popup__content")||popup.classList.remove("active")})),popupOpenBtns.forEach((function(e){e.addEventListener("click",(function(e){popup.classList.add("active");var t=mapRuls(e.currentTarget.getAttribute("data-ruls")),i=dataRules[t].textRules;popupText.innerHTML="".concat(i)}))})));var Canvas=function e(t){_classCallCheck(this,e),this.canvas=document.querySelector(t),this.context=this.canvas.getContext("2d")},Board=function(){function e(t,i,s,r){_classCallCheck(this,e),this.mainEl=document.querySelector(t),this.scoreEl=document.querySelector(i),this.cell=r,this.indentCell=2,this.score=0,this.context=s.context,this.canvas=s.canvas,this.widthCanvas=this.mainEl.clientWidth/2,this.heightCanvas=this.mainEl.clientHeight-300,this.widthGame=this.roundCell(this.widthCanvas,this.cell),this.heightGame=this.roundCell(this.heightCanvas,this.cell),this.canvas.setAttribute("width",this.widthGame),this.canvas.setAttribute("height",this.heightGame),this.rowGame=this.widthGame/this.cell,this.columnGame=this.heightGame/this.cell,this.barrier={levelEasy:[],levelHard:[{x:0,y:0},{x:0,y:this.cell},{x:this.cell,y:0},{x:this.cell,y:this.cell},{x:0,y:this.heightGame-this.cell},{x:0,y:this.heightGame-2*this.cell},{x:this.cell,y:this.heightGame-this.cell},{x:this.cell,y:this.heightGame-2*this.cell},{x:this.widthGame-this.cell,y:this.heightGame-this.cell},{x:this.widthGame-this.cell,y:this.heightGame-2*this.cell},{x:this.widthGame-2*this.cell,y:this.heightGame-this.cell},{x:this.widthGame-2*this.cell,y:this.heightGame-2*this.cell},{x:this.widthGame-this.cell,y:0},{x:this.widthGame-2*this.cell,y:0},{x:this.widthGame-this.cell,y:this.cell},{x:this.widthGame-2*this.cell,y:this.cell}]},this.barrierMap=this.barrier.levelEasy,this.drawGameBoard()}return _createClass(e,[{key:"updateMap",value:function(e){this.barrierMap=e}},{key:"updateCell",value:function(e){this.cell=e}},{key:"roundCell",value:function(e,t){return Math.round(e/t)*t}},{key:"drawGameBoard",value:function(){for(var e=0;e<this.columnGame;e++)for(var t=0;t<this.rowGame;t++)this.context.fillStyle="rgba(255, 255, 255, 0.4)",this.context.fillRect(t*this.cell,e*this.cell,this.cell-this.indentCell,this.cell-this.indentCell);this.drawScore(this.score),this.drawBarrier()}},{key:"drawBarrier",value:function(){var e=this;this.barrierMap.forEach((function(t){e.context.fillStyle="#333333",e.context.fillRect(t.x,t.y,e.cell-e.indentCell,e.cell-e.indentCell)}))}},{key:"drawScore",value:function(){return this.scoreEl.textContent="Счет: ".concat(this.score)}},{key:"zeroScore",value:function(){return this.score=0,this.scoreEl.textContent="Счет: 0"}},{key:"updateScore",value:function(e){this.score++,this.drawScore()}}]),e}(),Berry=function(){function e(t,i){_classCallCheck(this,e),this.context=t.context,this.cell=i.cell,this.radius=this.cell/3,this.rowGame=i.rowGame,this.columnGame=i.columnGame,this.pi=Math.PI,this.x,this.y}return _createClass(e,[{key:"draw",value:function(){this.context.beginPath(),this.context.fillStyle="#9f5e7e",this.context.arc(this.x+this.cell/2,this.y+this.cell/2,this.radius,0,2*this.pi),this.context.fill(),this.context.closePath()}},{key:"coordinats",value:function(){this.x=getRandomInt(0,this.rowGame)*this.cell,this.y=getRandomInt(0,this.columnGame)*this.cell}},{key:"newPosition",value:function(e,t){var i=this;this.coordinats(),e.forEach((function(e){e.x===i.x&&e.y===i.y&&i.coordinats()})),t.length>0&&t.forEach((function(e){e.x===i.x&&e.y===i.y&&i.coordinats()}))}}]),e}(),Snake=function(){function e(t,i){var s=this;_classCallCheck(this,e),this.context=t.context,this.cell=i.cell,this.indentCell=i.indentCell,this.heightGame=i.heightGame,this.x=0,this.y=3*this.cell,this.dx=this.cell,this.dy=0,this.tails=[{x:0,y:3*this.cell}],this.maxTails=3,this.keyDirection=null,this.handleControl=function(e){"ArrowUp"===e.code&&(null!==s.keyDirection&&"down"===s.keyDirection||(s.dx=0,s.dy=-s.cell,s.keyDirection="up")),"ArrowDown"===e.code&&(null!==s.keyDirection&&"up"===s.keyDirection||(s.dx=0,s.dy=s.cell,s.keyDirection="down")),"ArrowLeft"===e.code&&(null!==s.keyDirection&&"right"===s.keyDirection||(s.dx=-s.cell,s.dy=0,s.keyDirection="left")),"ArrowRight"===e.code&&(null!==s.keyDirection&&"left"===s.keyDirection||(s.dx=s.cell,s.dy=0,s.keyDirection="right"))}}return _createClass(e,[{key:"update",value:function(e,t,i,s,r){this.x+=this.dx,this.y+=this.dy,this.x<0&&(this.x=t.widthGame-this.cell),this.x>=t.widthGame&&(this.x=0),this.y<0&&(this.y=t.heightGame-this.cell),this.y>=t.heightGame&&(this.y=0),this.tails.unshift({x:this.x,y:this.y}),this.tails.length>this.maxTails&&this.tails.pop(),this.crachSnake(e,t,i,s),this.eatSnake(e,t,r)}},{key:"crachSnake",value:function(e,t,i,s){var r=this;this.tails.forEach((function(i,s){for(var n=s+1;n<r.tails.length;n++)i.x===r.tails[n].x&&i.y===r.tails[n].y&&(r.deth(),t.zeroScore(),e.newPosition(r.tails,t.barrierMap),0,300,document.removeEventListener("keydown",r.handleControl))})),t.barrierMap.forEach((function(i){i.x===r.tails[0].x&&i.y===r.tails[0].y&&(r.deth(),t.zeroScore(),e.newPosition(r.tails,t.barrierMap),0,300,document.removeEventListener("keydown",r.handleControl))}))}},{key:"eatSnake",value:function(e,t,i){var s=this;this.tails.forEach((function(i){i.x===e.x&&i.y===e.y&&(s.maxTails++,t.updateScore(),e.newPosition(s.tails,t.barrierMap),.7)}))}},{key:"draw",value:function(){var e=this;this.tails.forEach((function(t,i){e.context.fillStyle=0==i?"#333333":"#555555",e.context.fillRect(t.x,t.y,e.cell-e.indentCell,e.cell-e.indentCell)}))}},{key:"deth",value:function(){this.x=0,this.y=3*this.cell,this.dx=this.cell,this.dy=0,this.tails=[{x:0,y:3*this.cell}],this.maxTails=3,this.keyDirection=null}}]),e}(),Game=function(){function e(t,i,s,r,n){_classCallCheck(this,e),this.newGameBtn=document.querySelector(t),this.restartBtn=document.querySelector(i),this.easyLevelBtn=document.querySelector(s),this.hardLevelBtn=document.querySelector(r),this.fps=300,this.startTime=0,this.currentTime=0,this.time=0,this.currentSecond=0,this.speed=0,this.cell=n,this.canvas=new Canvas(".js-snake__game"),this.board=new Board(".js-snake",".js-snake__score-text",this.canvas,this.cell),this.berry=new Berry(this.canvas,this.board),this.snake=new Snake(this.canvas,this.board),this.gameLoopSnake=this.gameLoopSnake.bind(this),this.gameLoopSnake(),this.controls(),this.btns(),this.berry.newPosition(this.snake.tails,this.board.barrierMap)}return _createClass(e,[{key:"btns",value:function(){var e=this;this.newGameBtn.addEventListener("click",(function(){e.easyLevelBtn.removeAttribute("disabled"),e.hardLevelBtn.removeAttribute("disabled"),e.newGameBtn.setAttribute("disabled","disabled"),e.restartBtn.setAttribute("disabled","disabled"),document.addEventListener("keydown",e.snake.handleControl)})),this.easyLevelBtn.addEventListener("click",(function(){e.checkLevel(e.board.barrier.levelEasy)})),this.hardLevelBtn.addEventListener("click",(function(){e.checkLevel(e.board.barrier.levelHard)})),this.restartBtn.addEventListener("click",(function(){e.snake.deth(),e.board.zeroScore(),e.berry.newPosition(e.snake.tails,e.board.barrierMap),e.fps=300,e.startTime=0,document.addEventListener("keydown",e.snake.handleControl)}))}},{key:"controls",value:function(){document.addEventListener("keydown",this.snake.handleControl)}},{key:"checkLevel",value:function(e){this.board.updateMap(e),this.snake.deth(),this.board.zeroScore(),this.berry.newPosition(this.snake.tails,this.board.barrierMap),this.fps=300,this.startTime=0,this.restartBtn.removeAttribute("disabled"),this.newGameBtn.removeAttribute("disabled"),this.easyLevelBtn.setAttribute("disabled","disabled"),this.hardLevelBtn.setAttribute("disabled","disabled")}},{key:"gameLoopSnake",value:function(){requestAnimationFrame(this.gameLoopSnake),0===this.startTime&&(this.startTime=(new Date).getTime()),this.currentTime=(new Date).getTime(),this.time=this.currentTime-this.startTime,this.currentSecond=Math.floor(this.time/(this.fps-this.speed)),this.currentSecond>0&&(this.startTime=0,this.canvas.context.clearRect(0,0,this.board.widthGame,this.board.heightGame),this.board.drawGameBoard(),this.berry.draw(),this.snake.draw(),this.snake.update(this.berry,this.board,this.startTime,this.fps,this.speed))}}]),e}();function getRandomInt(e,t){return Math.floor(Math.random()*(t-e)+e)}function _createForOfIteratorHelper(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var s=0,r=function(){};return{s:r,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,a=!0,l=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return a=e.done,e},e:function(e){l=!0,n=e},f:function(){try{a||null==i.return||i.return()}finally{if(l)throw n}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,s=new Array(t);i<t;i++)s[i]=e[i];return s}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}null!==(game=document.querySelector(".js-snake"))&&new Game(".js-snake__new-game",".js-snake__restart",".js-snake__easy-level",".js-snake__hard-level",25);var game,TicTacToe=function(){function e(t,i,s,r,n,a){var l=this;_classCallCheck(this,e),this.gameBoard=document.querySelector(t),this.winText=document.querySelector(i),this.newGameBtn=document.querySelector(s),this.restartBtn=document.querySelector(r),this.easyLevelBtn=document.querySelector(n),this.hardLevelBtn=document.querySelector(a),this.origBoard,this.cells,this.keyLevel="easy",this.huPlayer="X",this.aiPlayer="O",this.huSymbol='<svg class="cross">\n    <line class="cross-first" x1="10" y1="10" x2="70" y2="70" stroke="#333" stroke-width="10" stroke-linecap="round" />\n    <line class="cross-second" x1="70" y1="10" x2="10" y2="70" stroke="#333" stroke-width="10" stroke-linecap="round" />\n    </svg>',this.aiSymbol='<svg class="circle">\n    <circle r="30" cx="40" cy="40" stroke="#c15746" stroke-width="10" fill="none" stroke-linecap="round" />\n    </svg>',this.winCombos=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[6,4,2]],this.handleTurnClick=function(e){"number"==typeof l.origBoard[e.target.id]&&(l.turn(e.target.id,l.huPlayer,l.huSymbol),l.checkTie()||l.checkWin(l.origBoard,l.huPlayer)||l.turn(l.BestSport(),l.aiPlayer,l.aiSymbol))},this.init()}return _createClass(e,[{key:"whoWinner",value:function(e){this.winText.innerText=e}},{key:"init",value:function(){for(var e=this,t=0;t<9;t++){var i=document.createElement("div");i.setAttribute("id",t),i.classList.add("tic-tac-toe__cell"),this.gameBoard.appendChild(i)}this.cells=document.querySelectorAll(".tic-tac-toe__cell"),this.newGameBtn.addEventListener("click",(function(){e.easyLevelBtn.removeAttribute("disabled"),e.hardLevelBtn.removeAttribute("disabled"),e.newGameBtn.setAttribute("disabled","disabled"),e.restartBtn.setAttribute("disabled","disabled")})),this.easyLevelBtn.addEventListener("click",(function(){e.checkLevel("easy")})),this.hardLevelBtn.addEventListener("click",(function(){e.checkLevel("hard")})),this.restartBtn.addEventListener("click",(function(){e.start()}))}},{key:"checkLevel",value:function(e){this.keyLevel=e,this.start(),this.restartBtn.removeAttribute("disabled"),this.newGameBtn.removeAttribute("disabled"),this.easyLevelBtn.setAttribute("disabled","disabled"),this.hardLevelBtn.setAttribute("disabled","disabled")}},{key:"start",value:function(){this.origBoard=[0,1,2,3,4,5,6,7,8];for(var e=0;e<this.cells.length;e++)this.cells[e].innerHTML="",this.cells[e].classList.add("pointer"),this.cells[e].addEventListener("click",this.handleTurnClick),this.winText.innerText=""}},{key:"turn",value:function(e,t,i){this.origBoard[e]=t,document.getElementById(e).innerHTML=i,this.cells[e].removeEventListener("click",this.handleTurnClick),this.cells[e].classList.remove("pointer"),this.checkWin(this.origBoard,t)&&this.gameOver(t)}},{key:"checkWin",value:function(e,t){var i,s=this.playerMoves(e,t),r=_createForOfIteratorHelper(this.winCombos);try{for(r.s();!(i=r.n()).done;){if(i.value.every((function(e){return-1!==s.indexOf(e)})))return!0}}catch(e){r.e(e)}finally{r.f()}return!1}},{key:"checkTie",value:function(){var e=this;if(0==this.emptySquares().length){for(var t=0;t<this.cells.length;t++)this.cells[t].removeEventListener("click",this.handleTurnClick);return setTimeout((function(){return e.whoWinner("Ничья")}),1200),!0}return!1}},{key:"gameOver",value:function(e){for(var t=this,i=0;i<this.cells.length;i++)this.cells[i].removeEventListener("click",this.handleTurnClick),this.cells[i].classList.remove("pointer");setTimeout((function(){return t.whoWinner(e===t.huPlayer?"Вы победили":"Вы проиграли")}),1200)}},{key:"emptySquares",value:function(){return this.origBoard.filter((function(e){return"number"==typeof e}))}},{key:"playerMoves",value:function(e,t){for(var i=[],s=0;s<e.length;s++){e[s]===t&&(i=i.concat(s))}return i}},{key:"BestSport",value:function(){return"easy"===this.keyLevel?this.BestSportEasy():"hard"===this.keyLevel?this.BestSportHard():void 0}},{key:"BestSportEasy",value:function(){var e,t=this.emptySquares(),i=this.playerMoves(this.origBoard,this.huPlayer),s=_createForOfIteratorHelper(this.winCombos);try{for(s.s();!(e=s.n()).done;){var r=e.value;if(i.includes(r[0])&&i.includes(r[1])){if(t.includes(r[2]))return r[2]}else if(i.includes(r[0])&&i.includes(r[2])){if(t.includes(r[3]))return r[1]}else if(i.includes(r[1])&&i.includes(r[2])&&t.includes(r[0]))return r[0]}}catch(e){s.e(e)}finally{s.f()}return t[Math.floor(Math.random()*t.length)]}},{key:"BestSportHard",value:function(){return this.minimax(this.origBoard,this.aiPlayer).index}},{key:"minimax",value:function(e,t){var i=this.emptySquares();if(this.checkWin(e,this.huPlayer))return{score:-10};if(this.checkWin(e,this.aiPlayer))return{score:10};if(0===i.length)return{score:0};for(var s,r=[],n=0;n<i.length;n++){var a={};if(a.index=e[i[n]],e[i[n]]=t,t==this.aiPlayer){var l=this.minimax(e,this.huPlayer);a.score=l.score}else{var o=this.minimax(e,this.aiPlayer);a.score=o.score}e[i[n]]=a.index,r.push(a)}if(t===this.aiPlayer)for(var c=-1/0,h=0;h<r.length;h++)r[h].score>c&&(c=r[h].score,s=h);else for(var u=1/0,d=0;d<r.length;d++)r[d].score<u&&(u=r[d].score,s=d);return r[s]}}]),e}();null!==(game=document.querySelector(".tic-tac-toe"))&&new TicTacToe(".js-tic-tac-toe__game",".js-tic-tac-toe__win-text",".js-tic-tac-toe__new-game",".js-tic-tac-toe__restart",".js-tic-tac-toe__easy-level",".js-tic-tac-toe__hard-level");
//# sourceMappingURL=main.js.map
